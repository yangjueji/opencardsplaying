package{	import flash.events.*;	import flash.net.*;	import flash.text.*;	import flash.system.*;	public class CWEnterInTask{		private var ip:String;		private var port:int;		private var userName:String;		private var socket:Socket;		private var debugInfo:TextField;		private var succeedFun:Function;		private var failFun:Function;		//private var roomIndex:int;				public function CWEnterInTask(ip:String,port:int,userName:String){			this.socket = new Socket();			this.ip = ip;			this.port = port;			this.userName = userName;			this.debugInfo = null;			socket.addEventListener(Event.CONNECT,connectHandler);			socket.addEventListener(Event.CLOSE, closeHandler);			socket.addEventListener(IOErrorEvent.IO_ERROR, ioErrorHandler);			socket.addEventListener(SecurityErrorEvent.SECURITY_ERROR, securityErrorHandler);			socket.addEventListener(ProgressEvent.SOCKET_DATA, socketDataHandler);		}				public function setDebugInfo(debugInfo:TextField):void{			this.debugInfo = debugInfo;		}				public function startTask():void{			socket.connect(ip,port);		}				public function setSucceedAndFailFunction(succeedFun:Function,failFun:Function):void{			this.succeedFun = succeedFun;			this.failFun = failFun;		}				private function connectHandler(event:Event):void{			showDebugInfo(event.toString());			socket.writeUTF("enter,"+userName+",");			socket.flush();		}				private function socketDataHandler(event:ProgressEvent):void{			showDebugInfo(event.toString());			var bufferString:String = socket.readUTFBytes(socket.bytesAvailable);			showDebugInfo(bufferString);			var requestArray:Array = bufferString.split(",");			if (requestArray[0] == "success"){				var index:int = requestArray[1];				trace(index);				this.succeedFun(index);			}			else{				this.failFun(-1);			}			socket.close();		}				private function ioErrorHandler(event:IOErrorEvent):void {			showDebugInfo(event.toString());			socket.close();    	}    	private function securityErrorHandler(event:SecurityErrorEvent):void {			showDebugInfo(event.toString());			socket.close();    	}				private function closeHandler(event:Event):void {			showDebugInfo(event.toString());			socket.close();    	}				private function showDebugInfo(info:String):void {			if(debugInfo!=null){				debugInfo.text = info;			}			trace(info);		}	}}